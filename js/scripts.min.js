/*
	author	: @EtienneLem
	company	: Heliom <http://heliom.ca>
*/
(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};window.Bivouac==null&&(window.Bivouac={}),a={},a.$header=$("header"),a.$figure=a.$header.find("figure"),Bivouac.App=function(){function c(){this.onControllerButtonClick=b(this.onControllerButtonClick,this),this.keys=["X","A","B","Y"],this.keysIndex=0,this.addHint(),this.addControllerButtons()}return c.prototype.addHint=function(){var b,c,d,e,f,g,h;this.pattern=[];for(b=0;b<=9;b++)e=Math.floor(Math.random()*this.keys.length),this.pattern.push(this.keys[e]);this.hint=$('<ul class="hint"></ul>'),h=this.pattern;for(f=0,g=h.length;f<g;f++)c=h[f],d=$("<li>"+c+"</li>"),this.hint.append(d);return a.$header.children(".wrap").prepend(this.hint)},c.prototype.addControllerButtons=function(){var b,c,d,e,f,g;f=this.keys,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],b=$('<a class="key" href="javascript:"></a>').data("value",c),b.on("click",this.onControllerButtonClick),g.push(a.$figure.append(b));return g},c.prototype.onControllerButtonClick=function(a){var b;b=$(a.currentTarget).data("value");if(b!==this.pattern[this.keysIndex])return this.hint.children(".valid").removeClass("valid"),this.keysIndex=0;this.hint.children().eq(this.keysIndex).addClass("valid"),this.keysIndex++;if(this.keysIndex===this.pattern.length)return new Bivouac.Invaders},c}(),Bivouac.Invaders=function(){function b(){var b=this;this.ship=a.$figure.children("img"),this.bullets=[],this.offset=0,this.speed=0,this.score=0,this.isShooting=!1,this.enemiesClass=["paolo","ramiro","zach"],this.enemiesClassIndex=4,this.countdown=7e3,this.startTime=new Date,this.isGoing={left:!1,right:!1},this.init(),this.initKeyboard(),this.addEnemies(),this.addScoreSpan(),_gaq&&_gaq.push(["_trackEvent","Space Invaders","Game initiated"]),this.rowTimeout=setTimeout(function(){return b.addRow()},this.countdown),this.gameTimer=setInterval(function(){return b.render()},16)}return b.prototype.init=function(){var b=this;return $(".key").remove(),a.$header.addClass("playing"),a.$figure.addClass("ship"),window.onblur=function(a){return b.isGoing.left=!1,b.isGoing.right=!1,b.isShooting=!1}},b.prototype.initKeyboard=function(){var a,b=this;return a=$("body"),a.bind("keydown",function(a){if([37,39,32].indexOf(a.keyCode)<0)return;switch(a.keyCode){case 37:return b.isGoing.left=!0;case 39:return b.isGoing.right=!0;case 32:return b.isShooting=!0,!1}}),a.bind("keyup",function(a){switch(a.keyCode){case 37:return b.isGoing.left=!1;case 39:return b.isGoing.right=!1;case 32:return b.isShooting=!1}})},b.prototype.render=function(){this.moveShip(),this.moveBullets();if(this.isShooting&&this.bullets.length<1)return this.shootBullet()},b.prototype.moveShip=function(){var a;a=this.ship.offset(),this.isGoing.left&&!this.isGoing.right&&(this.speed-=3),this.isGoing.right&&!this.isGoing.left&&(this.speed+=3),this.speed>51&&(this.speed=51),this.speed<-51&&(this.speed=-51);if(!this.isGoing.left&&!this.isGoing.right||this.isGoing.left&&this.isGoing.right)this.speed>0&&(this.speed-=3),this.speed<0&&(this.speed+=3);return a.left<0&&this.speed<0&&(this.speed=0),a.left+140>window.innerWidth&&this.speed>0&&(this.speed=0),this.offset+=this.speed,this.ship.css("-webkit-transform","translate3d(0,"+this.offset+"px,0)")},b.prototype.shootBullet=function(){var b;return b=$('<span class="bullet"></span>'),b.css("-webkit-transform","translate3d(0,"+this.offset+"px,0)"),a.$figure.append(b),this.bullets.push({elem:b,offsetX:0,offsetY:this.offset})},b.prototype.moveBullets=function(){var a,b,c,d,e,f,g,h,i;if(!(c=this.bullets[0]))return;d=c.elem.offset();if(d.top<-38)return c.elem.remove(),this.bullets.pop();i=this.enemies;for(f=0,h=i.length;f<h;f++){e=i[f],g=e.offset(),b={left:g.left,right:g.left+e.width(),bottom:g.top+e.height()},a=e.offset().top+e.height();if(d.top<=b.bottom&&d.left>=b.left&&d.left<=b.right){this.removeBullet(),e.addClass("dead"),this.enemies.splice(f,1),this.addScore(e.data("row")*10);return}}return c.offsetX+=30,c.elem.css("-webkit-transform","translate3d("+c.offsetX+"px,"+c.offsetY+"px,0)")},b.prototype.removeBullet=function(){var a;if(!(a=this.bullets[0]))return;return a.elem.remove(),this.bullets.pop()},b.prototype.addEnemies=function(){var b,c,d,e,f=this;this.enemies=[],this.enemiesContainer=$('<div class="enemies"></div>');for(e=0;e<=29;e++)b=Math.floor(e/10%10),d=this.createEnemy(b,b+1),d.addClass("hidden"),c=Math.floor(Math.random()*10+5),d.css("-webkit-transition-delay","0.0"+c+"s");return setTimeout(function(){var a,b,c,d,e;d=f.enemies,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.removeClass("hidden"));return e},100),a.$header.children().append(this.enemiesContainer)},b.prototype.createEnemy=function(a,b){var c;return c=$('<span class="hidden enemy"></span>'),c.addClass(this.enemiesClass[a]),c.data("row",b),this.enemiesContainer.prepend(c),this.enemies.push(c),c},b.prototype.addRow=function(){var a,b,c=this;for(b=0;b<=9;b++)a=this.createEnemy(this.enemiesClassIndex%this.enemiesClass.length,this.enemiesClassIndex),a.removeClass("hidden");if(this.enemiesClassIndex-$(".enemy").not(".dead").last().data("row")===5){this.endGame();return}return this.enemiesClassIndex++,this.countdown>3e3&&(this.countdown-=250),setTimeout(function(){return c.addRow()},this.countdown)},b.prototype.addScoreSpan=function(){return this.scoreSpan=$('<span class="score">Score: 0</span>'),a.$header.append(this.scoreSpan)},b.prototype.addScore=function(b){var c;return this.score+=b,this.scoreSpan.html("Score: "+this.score),c=$("<span class='score-increment'>+ "+b+"</span>"),a.$header.append(c),this.rowTimeout=setTimeout(function(){return c.addClass("animate")},0)},b.prototype.endGame=function(){var b,c,d,e,f,g,h=this;return $(".enemy").not(".dead").addClass("dead"),this.enemies=[],this.removeBullet(),clearInterval(this.gameTimer),clearTimeout(this.rowTimeout),e=new Date-this.startTime,e+=1e3,f=e/1e3,g=Math.floor(f%60),g<10&&(g="0"+g),c=f/60,d=Math.floor(c%60),d<10&&(d="0"+d),_gaq&&_gaq.push(["_trackEvent","Space Invaders","Score",""+this.score]),_gaq&&_gaq.push(["_trackEvent","Space Invaders","Duration",""+d+":"+g]),b=$('<div class="end-game hidden">\n  <span>Game Over</span>\n  <p>You scored '+this.score+'</p>\n  <div class="social-share hidden">\n    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://bivouacurbain.com" data-text="I scored '+this.score+' points! Can you beat me?" data-via="bivouacurbain" data-hashtags="easteregg">Tweet</a>\n    <div class="fb-like" data-href="http://bivouacurbain.com" data-send="false" data-layout="button_count" data-width="250" data-show-faces="false" data-font="lucida grande"></div>\n  </div>\n\n  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>\n\n  <div id="fb-root"></div>\n  <script>(function(d, s, id) {\n    var js, fjs = d.getElementsByTagName(s)[0];\n    if (d.getElementById(id)) return;\n    js = d.createElement(s); js.id = id;\n    js.src = "//connect.facebook.net/'+{fr:"fr_CA",en:"en_US"}[$("html").attr("lang")]+"/all.js#xfbml=1&appId=259990290693706\";\n    fjs.parentNode.insertBefore(js, fjs);\n  }(document, 'script', 'facebook-jssdk'));</script>\n</div>"),a.$header.append(b),setTimeout(function(){return b.removeClass("hidden"),setTimeout(function(){return $(".social-share").removeClass("hidden")},850)},500)},b}(),new Bivouac.App}).call(this)
